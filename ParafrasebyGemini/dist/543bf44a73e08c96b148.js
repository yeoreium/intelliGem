/*! For license information please see 543bf44a73e08c96b148.js.LICENSE.txt */
function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return _regeneratorDefine2(l,"_invoke",function(n,r,a){var o,s,c,l=0,u=a||[],d=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,s=0,c=e,m.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&l&&!a&&t<u.length;t++){var a,o=u[t],p=m.p,g=o[2];n>3?(a=g===r)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=n<2&&p<o[1])?(s=0,m.v=r,m.n=o[1]):p<g&&(a=n<3||o[0]>r||r>g)&&(o[4]=n,o[5]=r,m.n=g,s=0))}if(a||n>1)return i;throw d=!0,r}return function(a,u,g){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,g),s=u,c=g;(t=s<2?e:c)||!d;){o||(s?s<3?(s>1&&(m.n=-1),p(s,c)):m.n=c:m.v=c);try{if(l=2,o){if(s||(a="next"),t=o[a]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((t=(d=m.n<0)?c:n.call(r,m))!==i)break}catch(t){o=e,s=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,a,o),!0),l}var i={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),d=l.prototype=s.prototype=Object.create(u);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=l,_regeneratorDefine2(d,"constructor",l),_regeneratorDefine2(l,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(l,a,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,a,"Generator"),_regeneratorDefine2(d,r,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:m}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,t,n,r){if(t)a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var o=function(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})};o("next",0),o("throw",1),o("return",2)}},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){asyncGeneratorStep(o,r,a,i,s,"next",e)}function s(e){asyncGeneratorStep(o,r,a,i,s,"throw",e)}i(void 0)})}}var BACKEND_URL="http://localhost:3001/api/intelligem",currentPage="welcome-page";function navigateToPage(e){if(currentPage!==e){var t=document.getElementById(currentPage);t?(t.classList.add("fade-out"),setTimeout(function(){showPage(e),currentPage=e},200)):(showPage(e),currentPage=e)}}function showPage(e){["welcome-page","main-page","settings-page"].forEach(function(e){var t=document.getElementById(e);t&&(t.style.display="none",t.classList.remove("fade-in","fade-out"))});var t=document.getElementById(e);t&&(t.style.display="flex",t.classList.add("fade-in"),"main-page"===e&&setTimeout(function(){var e=document.getElementById("textPromptInput");e&&e.focus()},300)),console.log("Navigated to: ".concat(e))}function sendPrompt(){return _sendPrompt.apply(this,arguments)}function _sendPrompt(){return _sendPrompt=_asyncToGenerator(_regenerator().m(function e(){var t,n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("textPromptInput"),n=t.value.trim(),clearMessages(),disableButtons(!0),n){e.n=1;break}return showError("Mohon masukkan perintah atau pertanyaan Anda."),disableButtons(!1),e.a(2);case 1:return addMessageToChat("user",n),t.value="",showTypingIndicator(),e.p=2,e.n=3,Word.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var r,a,o,i,s,c,l;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=t.document.getSelection()).load("text"),r.load("inlinePictures"),e.n=1,t.sync();case 1:if(a=r.text.trim(),o=null,!(r.inlinePictures.items.length>0)){e.n=3;break}return(i=r.inlinePictures.items[0]).load("getBase64ImageSrc"),e.n=2,t.sync();case 2:(o=i.getBase64ImageSrc)&&(s=o.split(","),o=s.length>1?s[1]:null);case 3:return(c=t.document.body).load("text"),e.n=4,t.sync();case 4:return l=c.text.trim(),e.n=5,callIntelligemAPI(n,a,o,l);case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.error("Kesalahan saat mengirim prompt ke Intelligem:",r),showError("Terjadi kesalahan: ".concat(r.message,". Periksa console."));case 5:return e.p=5,hideTypingIndicator(),disableButtons(!1),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])})),_sendPrompt.apply(this,arguments)}function callIntelligemAPI(e,t,n,r){return _callIntelligemAPI.apply(this,arguments)}function _callIntelligemAPI(){return(_callIntelligemAPI=_asyncToGenerator(_regenerator().m(function e(t,n,r,a){var o,i,s,c,l;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return showStatus("Intelligem sedang memproses... Harap tunggu."),e.p=1,o={userPrompt:t,selectedText:n,fullDocumentText:a},r&&(o.imageData=r),e.n=2,fetch(BACKEND_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 2:if(i=e.v,console.log("Response status dari backend Intelligem:",i.status),i.ok){e.n=4;break}return e.n=3,i.json().catch(function(){return{}});case 3:throw s=e.v,new Error("HTTP error! Status: ".concat(i.status," - ").concat(s.error||i.statusText||"Unknown error from backend"));case 4:return e.n=5,i.json();case 5:c=e.v,console.log("Data diterima dari backend Intelligem:",c),hideTypingIndicator(),c.explanation?addMessageToChat("ai",c.explanation,c.type,n,c.actionable_text):(showError("Gagal mendapatkan respons AI yang valid dari Intelligem."),addMessageToChat("ai","Intelligem: Maaf, saya tidak bisa memproses permintaan Anda.")),showStatus("Respons Intelligem diterima."),e.n=7;break;case 6:e.p=6,l=e.v,console.error("Kesalahan saat memanggil Intelligem API:",l),hideTypingIndicator(),showError("Terjadi kesalahan: ".concat(l.message,".")),addMessageToChat("ai","Intelligem: Terjadi kesalahan. ".concat(l.message));case 7:return e.a(2)}},e,null,[[1,6]])}))).apply(this,arguments)}function insertAIResponse(e,t){return _insertAIResponse.apply(this,arguments)}function _insertAIResponse(){return _insertAIResponse=_asyncToGenerator(_regenerator().m(function e(t,n){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Word.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return a=r.document.getSelection(),"replace"===t?a.insertText(n,Word.InsertLocation.replace):"insert"===t&&a.insertText(n,Word.InsertLocation.after),e.n=1,r.sync();case 1:showStatus("Teks berhasil disisipkan/diganti!");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,r=e.v,console.error("Gagal menyisipkan/mengganti teks:",r),showError("Gagal menyisipkan/mengganti: ".concat(r.message));case 3:return e.a(2)}},e,null,[[0,2]])})),_insertAIResponse.apply(this,arguments)}function addMessageToChat(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"general",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=document.getElementById("chatHistory"),i=document.createElement("div");if(i.classList.add("chat-message","".concat(e,"-message")),"ai"===e){var s=document.createElement("div");s.classList.add("message-header");var c=document.createElement("i");c.classList.add("fas","fa-robot","ai-icon");var l=document.createElement("span");l.classList.add("ai-name"),l.textContent="Intelligem",s.appendChild(c),s.appendChild(l),i.appendChild(s);var u=document.createElement("p");if(u.innerHTML=marked.parse(t),i.appendChild(u),a){var d=document.createElement("div");d.classList.add("ai-actionable-text-box"),d.innerText=a,i.appendChild(d);var m=document.createElement("div");m.classList.add("ai-actions");var p=document.createElement("button");p.classList.add("ai-action-button"),p.innerHTML='<i class="fas fa-exchange-alt"></i> Ganti Teks Asli',p.onclick=function(){return insertAIResponse("replace",a)},m.appendChild(p);var g=document.createElement("button");g.classList.add("ai-action-button"),g.innerHTML='<i class="fas fa-plus"></i> Sisipkan Baru',g.onclick=function(){return insertAIResponse("insert",a)},m.appendChild(g),i.appendChild(m),i.dataset.actionableText=a,r&&(i.dataset.originalContextText=r)}if(r&&("paraphrase"===n||"summarize"===n||"general_text"===n||"image_description"===n)){var f=i.querySelector(".ai-actions");f||((f=document.createElement("div")).classList.add("ai-actions"),i.appendChild(f));var y=document.createElement("button");y.classList.add("ai-action-button"),y.innerHTML='<i class="fas fa-search"></i> Cari Sumber Teks Ini',y.onclick=function(){return addMessageToChat("user",'Cari sumber untuk: "'.concat(r.substring(0,Math.min(r.length,50)),'..."')).then(function(){return sendPromptFromSpecificContext('Cari sumber untuk teks ini: "'.concat(r,'"'))})},f.appendChild(y)}}else i.innerText=t;o.appendChild(i),o.scrollTop=o.scrollHeight,textPromptInput.focus()}function sendPromptFromSpecificContext(e){return _sendPromptFromSpecificContext.apply(this,arguments)}function _sendPromptFromSpecificContext(){return(_sendPromptFromSpecificContext=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return document.getElementById("textPromptInput").value=t,e.n=1,sendPrompt();case 1:return e.a(2)}},e)}))).apply(this,arguments)}function disableButtons(e){document.getElementById("sendPromptButton").disabled=e,document.getElementById("textPromptInput").disabled=e}function showStatus(e){var t=document.getElementById("statusMessage"),n=document.getElementById("errorMessage");t.querySelector(".status-text").innerText=e,t.style.display="flex",n.style.display="none"}function showError(e){var t=document.getElementById("statusMessage"),n=document.getElementById("errorMessage");n.querySelector(".error-text").innerText=e,n.style.display="flex",t.style.display="none"}function clearMessages(){document.getElementById("statusMessage").style.display="none",document.getElementById("errorMessage").style.display="none",document.getElementById("statusMessage").querySelector(".status-text").innerText="",document.getElementById("errorMessage").querySelector(".error-text").innerText=""}function showTypingIndicator(){var e=document.getElementById("chatHistory"),t=e.querySelector(".typing-indicator");t&&t.remove();var n=document.createElement("div");n.classList.add("ai-message","chat-message","typing-indicator"),n.style.maxWidth="80px";var r=document.createElement("div");r.classList.add("message-header");var a=document.createElement("i");a.classList.add("fas","fa-robot","ai-icon");var o=document.createElement("span");o.classList.add("ai-name"),o.textContent="Intelligem",r.appendChild(a),r.appendChild(o),n.appendChild(r);var i=document.createElement("div");i.style.display="flex",i.style.gap="4px",i.style.marginTop="8px";for(var s=0;s<3;s++){var c=document.createElement("div");c.classList.add("typing-dot"),i.appendChild(c)}n.appendChild(i),e.appendChild(n),e.scrollTop=e.scrollHeight}function hideTypingIndicator(){var e=document.querySelector(".typing-indicator");e&&e.remove()}Office.onReady(function(e){if(e.host===Office.HostType.Word){console.log("Office.js is ready. Host type:",e.host);var t=document.getElementById("sideload-msg");t&&(t.style.display="none"),showPage("welcome-page"),document.getElementById("startButton").onclick=function(){return navigateToPage("main-page")},document.getElementById("settingsButton").onclick=function(){return navigateToPage("settings-page")},document.getElementById("backToMainButton").onclick=function(){return navigateToPage("main-page")},document.getElementById("sendPromptButton").onclick=sendPrompt,document.getElementById("textPromptInput").addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendPrompt())}),console.log("UI terhubung.")}else console.log("Add-in tidak berjalan di Word.")});